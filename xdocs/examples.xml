<?xml version="1.0"?>
<!--
   Copyright 2003-2004 The Apache Software Foundation

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->

<document>

 <properties>
  <title>JDBC Utility Component -- Examples</title>
  <author email="yoavs@apache.org">Yoav Shapira</author>
  <author email="dgraham@apache.org">David Graham</author>
 </properties>

<body>

<section name="DbUtils: JDBC Utility Component Examples">
<p>
This page provides examples that show how DbUtils may be used.
</p>
</section>

<section name="Basic Usage">
<p>
DbUtils is a very small library of classes so it won't take long 
to go through the <a href="apidocs/">javadocs</a> for each class.  
The core classes/interfaces in DbUtils are 
<code><a href="apidocs/org/apache/commons/dbutils/QueryRunner.html">QueryRunner</a></code>
and
<code><a href="apidocs/org/apache/commons/dbutils/ResultSetHandler.html">ResultSetHandler</a></code>.
You don't need to know about any other DbUtils classes to benefit from using the 
library.  The following example demonstrates how these classes are used together.
</p>

<source>
<![CDATA[
// Create a ResultSetHandler implementation to convert the
// first row into an Object[].
ResultSetHandler h = new ResultSetHandler() {
    public Object handle(ResultSet rs) throws SQLException {
        ResultSetMetaData meta = rs.getMetaData();
        int cols = meta.getColumnCount();
        Object[] result = new Object[cols];

        for (int i = 0; i < cols; i++) {
            result[i] = rs.getObject(i + 1);
        }

        return result;
    }
};

// Create a QueryRunner that will use connections from
// the given DataSource
QueryRunner run = new QueryRunner(dataSource);

// Execute the query and get the results back from the handler
Object[] result = (Object[]) run.query(
    "SELECT * FROM Person WHERE name=?", "John Doe", h);
]]>
</source>


<p>
You could also perform the previous query using a <code>java.sql.Connection</code> object
instead of a <code>DataSource</code>.  Notice that you are responsible for closing the
<code>Connection</code> in this example.
</p>
<source>
<![CDATA[
ResultSetHandler h = new ResultSetHandler() {
    public Object handle(ResultSet rs) throws SQLException {
        ResultSetMetaData meta = rs.getMetaData();
        int cols = meta.getColumnCount();
        Object[] result = new Object[cols];

        for (int i = 0; i < cols; i++) {
            result[i] = rs.getObject(i + 1);
        }

        return result;
    }
};

QueryRunner run = new QueryRunner();

Connection conn = ... // open a connection
try{
    Object[] result = (Object[]) run.query(
        conn, "SELECT * FROM Person WHERE name=?", "John Doe", h);
	// do something with the result
	
} finally {
    // use this helper method so we don't have to check for null
    DbUtils.close(conn);  
}
]]>
</source>
</section>


<section name="ResultSetHandler Implementations">
<p>
In the examples above we implemented the <code>ResultSetHandler</code> interface
to turn the first row of the <code>ResultSet</code> into an Object[].  This is a
fairly generic implementation that can be reused across many projects.
In recognition of this DbUtils provides a set of <code>ResultSetHandler</code>
implementations in the 
<a href="apidocs/org/apache/commons/dbutils/handlers/package-summary.html">org.apache.commons.dbutils.handlers</a> 
package that perform common transformations into arrays, Maps, and JavaBeans.
There is a version of each implementation that converts just the first row and 
another that converts all rows in the <code>ResultSet</code>. 
</p>

<source>
QueryRunner run = new QueryRunner(dataSource);

// Use the BeanHandler implementation to convert the first
// ResultSet row into a Person JavaBean.
ResultSetHandler h = new BeanHandler(Person.class);

// Execute the SQL statement with one replacement parameter and
// return the results in a new Person object generated by the BeanHandler.
Person p = (Person) run.query(
    "SELECT * FROM Person WHERE name=?", "John Doe", h); 
</source>

</section>

<section name="Custom RowProcessor">
<p>
Each of the provided <code>ResultSetHandler</code> implementations accept a 
<a href="apidocs/org/apache/commons/dbutils/RowProcessor.html">RowProcessor</a>
to do the actual conversion of rows into objects.  By default the handlers
use the <a href="apidocs/org/apache/commons/dbutils/BasicRowProcessor.html">BasicRowProcessor</a> 
implementation but you can implement a custom version to plug in.
Probably the most common customization is to implement the <code>toBean()</code>
method to handle custom database datatype issues.
</p>
</section>

<section name="Custom ColumnProcessor">
<p>
<code>BasicRowProcessor</code> uses a <a href="apidocs/org/apache/commons/dbutils/ColumnProcessor.html">ColumnProcessor</a>
to convert <code>ResultSet</code> columns into JavaBean properties.  You can implement this interface
to handle datatype mapping specific to your application.  By default <code>BasicRowProcessor</code> uses a
<a href="apidocs/org/apache/commons/dbutils/BasicColumnProcessor.html">BasicColumnProcessor</a>
instance which may be sufficient for your application.
</p>
</section>

</body>
</document>

